# Action Validation

Action validation is a critical component of Token World, ensuring that agent actions are grounded, logical, and impactful. This section dives into how the framework processes, validates, and executes actions generated by agents.

---

## Workflow: Action Validation

1. **Action Generation**  
   - Agents generate natural language actions based on their goals and the environment.  
   - Example: *"Harvest apples from the tree."*

2. **Precondition Check**  
   - The environment validates whether the action is feasible by checking preconditions against the relevant entities.  
   - Example:
     - The tree must have apples available.
     - The agent must possess a tool if required.

3. **Effect Application**  
   - If preconditions are met, the environment applies the action’s effects, updating the states of entities and agents.  
   - Example:
     - Apples are removed from the tree.
     - The agent’s inventory is updated to include apples.

4. **Logging and Feedback**  
   - The result of the action (success or failure) is logged.
   - If the action fails, feedback is provided to help agents adjust their goals.

---

## Precondition and Effect Examples

### Example 1: Eating an Apple
- **Preconditions**:
  - The agent must have an "isPerson" property.
  - The entity (apple) must have an "isEdible" property.
- **Effects**:
  - The entity is removed from the environment.
  - The agent’s hunger is reduced by the apple’s calorie value.

### Example 2: Building a Shelter
- **Preconditions**:
  - The agent must have "isBuilder" as a property.
  - The environment must have enough "Wood" and "Stone" resources.
- **Effects**:
  - Resources are consumed.
  - A new entity ("Shelter") is added to the environment.

---

## Dynamic Mechanic Generation

Token World dynamically generates new mechanics when agents perform novel actions.  
Example:
- **Action**: "Explore the forest."
- **Preconditions**: Forest entity must exist, and the agent must have a "curiosity" trait.
- **Effects**:
  - New resources (e.g., trees) are discovered with wood properties.

---

## Error Handling

### Failed Preconditions
- **Scenario**: Agent attempts to eat an apple, but the apple is not available.  
- **Response**: Log the failure and provide feedback to the agent, such as *"Apple not found."*

### Invalid Actions
- **Scenario**: Agent tries to "fly," but no flying mechanic exists.  
- **Response**: The action is rejected, and feedback is provided: *"Action unsupported."*

---

## Extending Action Validation

1. **Adding New Actions**  
   - Define preconditions and effects for new actions in the `actions` module.

2. **Custom Grounding Logic**  
   - Extend the `grounding` module to introduce new validation mechanisms.

3. **Action-Specific Rules**  
   - Add scenario-specific rules in the `config/rules.json` file.

---

## Next Steps

For more details, explore:  
- [Environment Design](environment.md)  
- [Sub-Agent Delegation](sub_agents.md)  
